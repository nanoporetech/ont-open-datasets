{"componentChunkName":"component---src-templates-blog-post-js","path":"/bonito/","result":{"data":{"site":{"siteMetadata":{"title":"Oxford Nanopore Technologies Open Datasets"}},"markdownRemark":{"id":"b34aa936-ef41-5094-8970-0bc8764beb12","excerpt":"We are please to announce the addition of\nbonito basecalling results to the\nGM24385 dataset. Bonito is a research-grade, open source basecaller utilising\nthe…","html":"<p>We are please to announce the addition of\n<a href=\"https://github.com/nanoporetech/bonito\">bonito</a> basecalling results to the\nGM24385 dataset. Bonito is a research-grade, open source basecaller utilising\nthe <a href=\"https://pytorch.org/\">PyTorch</a> library; its development explores\nalternative basecalling frameworks to those use in the product-grade Guppy\nbasecalling software.</p>\n<p>The Bonito basecalling for the GM24385 dataset was performed using Bonito\nversion 0.3.0, driven by the same <a href=\"/ont-open-datasets/katuali_human_pipeline/\">katuali</a> analysis\npipeline as for the initial dataset release.  The Bonito basecaller was\nprovided as input the per-chromosome <code class=\"language-text\">.fast5</code> files created in the initial\npipeline via alignment of the Guppy 4.0.11 basecalls. This allows for easy\ncomparison of results on subsets of the data (but may lead to subtle\nside-effects). For example the analysis data structure contains now entries of\nthe form:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gm24385_2020.09/analysis/r9.4.1/{flowcell}/guppy_{suffix}/align_unfiltered/{chromosome}/bonito\n├── align_unfiltered\n│   ├── align_to_ref.log\n│   ├── basecall_stats.log\n│   ├── calls2ref.bam\n│   ├── calls2ref.bam.bai\n│   └── calls2ref_stats.txt\n└── basecalls.fastq.gz</code></pre></div>\n<p>The file <code class=\"language-text\">basecalls.fastq.gz</code> contains the basecalling results from Bonito. The\nquality scores in these files have been mocked as the pre-release build of Bonito used\ndoes not yet provide quality scores. Similar to the main folder structure the\n<code class=\"language-text\">align_unfiltered</code> directory contains unfiltered alignments of the basecalls to\nthe reference sequence (<code class=\"language-text\">calls2ref.bam</code>) along with text files summarizing the\nproperties of the alignments.</p>\n<h3>Comparison with Guppy 4.0.11 basecalls</h3>\n<p>As a basis for comparison with the current Guppy basecaller we can use the alignment summary\nfiles for both the Guppy and Bonito basecalls. To simplify the analysis we compare only chromosome 1\ndata for a single flowcell; we can download the files with:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">aws s3 cp --no-sign-request s3://ont-open-data/gm24385_2020.09/analysis/r9.4.1/20200914_1354_6B_PAF27096_e7c9eae6/guppy_v4.0.11_r9.4.1_hac_prom/align_unfiltered/chr1/calls2ref_stats.txt guppy.stats\naws s3 cp --no-sign-request s3://ont-open-data/gm24385_2020.09/analysis/r9.4.1/20200914_1354_6B_PAF27096_e7c9eae6/guppy_v4.0.11_r9.4.1_hac_prom/align_unfiltered/chr1/bonito/align_unfiltered/calls2ref_stats.txt bonito.stats</code></pre></div>\n<p>The following python code,</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">from concurrent.futures import ProcessPoolExecutor\n\nimport pandas as pd\n\nimport aplanat.util\nfrom aplanat import lines\nfrom aplanat.layouts import facet_grid\nfrom aplanat.report import HTMLReport\n\n\ndef read_data(args):\n    caller, filename = args\n    df = pd.read_csv(filename, sep=&#39;\\t&#39;)\n    xs, ys = aplanat.util.kernel_density_estimate(df[&#39;acc&#39;], step=0.2)\n    df = pd.DataFrame({&#39;accuracy&#39;:xs, &#39;density&#39;:ys})\n    df[&#39;caller&#39;] = caller\n    return df\n\ndata_sets = {\n    &#39;bonito&#39;: &#39;bonito.stats&#39;,\n    &#39;guppy&#39;: &#39;guppy.stats&#39;}\n\nwith ProcessPoolExecutor() as executor:\n    report = HTMLReport(&quot;Basecalling Accuracy Summary&quot;, &quot;GM24385&quot;)\n    dfs = list(executor.map(read_data, data_sets.items()))\nplot = lines.line(\n    [df[&#39;accuracy&#39;] for df in dfs],\n    [df[&#39;density&#39;] for df in dfs],\n    colors=[&#39;red&#39;, &#39;blue&#39;],\n    names=[&#39;bonito&#39;, &#39;guppy&#39;],\n    xlim=(85,100),\n    x_axis_label=&#39;Alignment accuracy&#39;,\n    y_axis_label=&#39;Density&#39;)\nplot.legend.location = &#39;top_left&#39;\nreport.plot(plot)\nreport.write(&quot;report.html&quot;)</code></pre></div>\n<p>can be used to plot a kernel density estimate for the read alignment accuracy:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/ont-open-datasets/static/42f0fb8d3e170582982fad0aaf0a8f19/0a47e/accuracy.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABh0lEQVQoz4VSCW7cMAz0/9/YNkCzTro+1ocOizo4Hcm7zbYJUBkEZZocDofuVNUbY1KOEnOKMaUUSyn/N9WorCnTFEvO5zuti8SYbzOCCeh/9hinEfXwY7Pn+0dMEROQjAf2DZrzn7yOPi7LDeSn1nn13uvjkMlf/h7VzNf1ltQMTouQWK2peMzrrDVxXVdw2pMODwFat8++phQYW9k5uFUQheysRePNvO5yucRt28DR9VH8FeAD7AgKawpBNhwHEGwE3BNgFbIy/AD8h9ndHrptO+PGQCUgMWw2Br1tdU3DurFlWZByuo+s7Tlvpd0oL2sy9lmQVy4hHKCMyKmOzwzHBjmdgJkrn8YJ4kULE4LLcHuGN6e52cMOFuFG4byvAuP5uDr2ekCP0Jq3LcshePvW6/XliqUfML++wQwzJnq7bATeEcjqEMHOcS2XUKfiH0G/YrgajK8jc8KpYe0kUVSSUBcyo9p12BCFmu34/uMF7++/0Pd9A6raOufA6Rpo5rgxRQgb/gYK0w4BjKudtAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"accuracy comparison\"\n        title=\"Basecalls: Bonito CTC-CRF vs. Guppy 4.0.11\"\n        src=\"/ont-open-datasets/static/42f0fb8d3e170582982fad0aaf0a8f19/fcda8/accuracy.png\"\n        srcset=\"/ont-open-datasets/static/42f0fb8d3e170582982fad0aaf0a8f19/12f09/accuracy.png 148w,\n/ont-open-datasets/static/42f0fb8d3e170582982fad0aaf0a8f19/e4a3f/accuracy.png 295w,\n/ont-open-datasets/static/42f0fb8d3e170582982fad0aaf0a8f19/fcda8/accuracy.png 590w,\n/ont-open-datasets/static/42f0fb8d3e170582982fad0aaf0a8f19/0a47e/accuracy.png 600w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The plot indicates a roughly one-third decrease in the modal accuracy of reads.</p>","frontmatter":{"title":"Bonito basecalling with R9.4.1","date":"October 15, 2020","description":"Bonito basecalling with R9.4.1 and GM24385 (GIAB HG002)"}}},"pageContext":{"slug":"/bonito/","previous":{"fields":{"slug":"/gm24385_snp/"},"frontmatter":{"title":"Small variant calling with GM24385"}},"next":null}},"staticQueryHashes":["1246554614","1462070832","2841359383"]}