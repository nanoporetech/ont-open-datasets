{"componentChunkName":"component---src-templates-blog-post-js","path":"/bonito/","result":{"data":{"site":{"siteMetadata":{"title":"Oxford Nanopore Technologies Open Datasets"}},"markdownRemark":{"id":"b34aa936-ef41-5094-8970-0bc8764beb12","excerpt":"Updated 2020-10-30: This page was edited to reflect the formal release of Bonito v0.3.0 We are please to announce the addition of\nbonito basecalling results to…","html":"<p><strong>Updated 2020-10-30: This page was edited to reflect the formal release of Bonito v0.3.0</strong></p>\n<p>We are please to announce the addition of\n<a href=\"https://github.com/nanoporetech/bonito\">bonito</a> basecalling results to the\nGM24385 dataset. Bonito is a research-grade, open source basecaller utilising\nthe <a href=\"https://pytorch.org/\">PyTorch</a> library; its development explores\nalternative basecalling frameworks to those use in the product-grade Guppy\nbasecalling software.</p>\n<p>The Bonito basecalling for the GM24385 dataset was performed using version\n0.3.0, driven by the same <a href=\"/ont-open-datasets/katuali_human_pipeline/\">katuali</a> analysis pipeline\nas for the initial dataset release.  The Bonito basecaller was provided as\ninput the per-chromosome <code class=\"language-text\">.fast5</code> files created in the initial pipeline via\nalignment of the Guppy 4.0.11 basecalls. This allows for easy comparison of\nresults on subsets of the data (but may lead to subtle side-effects). For\nexample the analysis data structure contains now entries of the form:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gm24385_2020.09/analysis/r9.4.1/{flowcell}/guppy_{suffix}/align_unfiltered/{chromosome}/bonito_v0.3.0/\n├── align_unfiltered\n│   ├── align_to_ref.log\n│   ├── basecall_stats.log\n│   ├── calls2ref.bam\n│   ├── calls2ref.bam.bai\n│   └── calls2ref_stats.txt\n├── basecalls.fastq.gz\n└── basecalls.fastq.gz_summary.tsv</code></pre></div>\n<p>The file <code class=\"language-text\">basecalls.fastq.gz</code> contains the basecalling results from Bonito. The\nquality scores in these files have been mocked as the pre-release build of Bonito used\ndoes not yet provide quality scores. Similar to the main folder structure the\n<code class=\"language-text\">align_unfiltered</code> directory contains unfiltered alignments of the basecalls to\nthe reference sequence (<code class=\"language-text\">calls2ref.bam</code>) along with text files summarizing the\nproperties of the alignments.</p>\n<h3>Comparison with Guppy 4.0.11 basecalls</h3>\n<p>As a basis for comparison with the current Guppy basecaller we can use the alignment summary\nfiles for both the Guppy and Bonito basecalls. To simplify the analysis we compare only chromosome 1\ndata for a single flowcell; we can download the files with:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">aws s3 cp --no-sign-request s3://ont-open-data/gm24385_2020.09/analysis/r9.4.1/20200914_1354_6B_PAF27096_e7c9eae6/guppy_v4.0.11_r9.4.1_hac_prom/align_unfiltered/chr1/calls2ref_stats.txt guppy.stats\naws s3 cp --no-sign-request s3://ont-open-data/gm24385_2020.09/analysis/r9.4.1/20200914_1354_6B_PAF27096_e7c9eae6/guppy_v4.0.11_r9.4.1_hac_prom/align_unfiltered/chr1/bonito_v0.3.0/align_unfiltered/calls2ref_stats.txt bonito.stats</code></pre></div>\n<p>The following <a href=\"/ont-open-datasets/c0d85ae03e203a7f7e5cdaab853f6819/plot.py\">python code</a>,</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">from concurrent.futures import ProcessPoolExecutor\n\nimport pandas as pd\n\nimport aplanat.util\nfrom aplanat import lines\nfrom aplanat.layouts import facet_grid\nfrom aplanat.report import HTMLReport\n\n\ndef read_data(args):\n    caller, filename = args\n    df = pd.read_csv(filename, sep=&#39;\\t&#39;)\n    xs, ys = aplanat.util.kernel_density_estimate(df[&#39;acc&#39;], step=0.05)\n    df = pd.DataFrame({&#39;accuracy&#39;:xs, &#39;density&#39;:ys})\n    df[&#39;caller&#39;] = caller\n    return df\n\ndata_sets = {\n    &#39;bonito&#39;: &#39;bonito.stats&#39;,\n    &#39;guppy&#39;: &#39;guppy.stats&#39;}\n\nwith ProcessPoolExecutor() as executor:\n    report = HTMLReport(&quot;Basecalling Accuracy Summary&quot;, &quot;GM24385&quot;)\n    dfs = list(executor.map(read_data, data_sets.items()))\nplot = lines.line(\n    [df[&#39;accuracy&#39;] for df in dfs],\n    [df[&#39;density&#39;] for df in dfs],\n    colors=[&#39;red&#39;, &#39;blue&#39;],\n    names=[&#39;bonito&#39;, &#39;guppy&#39;],\n    xlim=(85,100),\n    x_axis_label=&#39;Alignment accuracy&#39;,\n    y_axis_label=&#39;Density&#39;)\nplot.legend.location = &#39;top_left&#39;\nreport.plot(plot)\nreport.write(&quot;report.html&quot;)</code></pre></div>\n<p>can be used to plot a kernel density estimate for the read alignment accuracy:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/ont-open-datasets/static/53bb1ce70c47b4b55e01304c2e3b79e1/0a47e/accuracy.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABiElEQVQoz4VSi3LcIAz0/39jm8y056Rnx08eBgHaLDhOe9PMBI8GYYnVakUHwBtrU4pRchKRlKSU8r1pEa254yglZ55VlNZViHmZEUxA/6vH+DaiLgab/ev//afIBSjOQ/cdBP7M67jLNE0gP7XOq/der0UmD/vl1+MyZzV3R54kZm0tU4PaWWtlXVeQ6UmHi5datf/3mlJgHFnYA24+IDEDzqLxZl53u91k27YGeF3+CvAEU4RAQEvXbmAzCE4eAauQF8OLxQMgzzWxgqWs2Aw5WgIcnmfAGMa8BQdzalgBl3VhMH20rO07vdK8CuRdxjYL8sYheAfKiJzO9uEMNKcTMHH04zAi+kiBC1vIcHvmW6pWmk72bhFm3nS0j4lei4NG3AOLHK14m3IMES8/er0/37H0I6bbC8ww4Y3PyMwrgXdqd+CIEbsx4CCxLAs19NxXDIPF+HtAOI6z5VopStSYIlIhMwZqS0EiNr6zn0/PeH39g77vG1DV1pFtpm4VlO8akgSRBd8BFWAN/o603t0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"accuracy comparison\"\n        title=\"Basecalls: Bonito CTC-CRF vs. Guppy 4.0.11\"\n        src=\"/ont-open-datasets/static/53bb1ce70c47b4b55e01304c2e3b79e1/fcda8/accuracy.png\"\n        srcset=\"/ont-open-datasets/static/53bb1ce70c47b4b55e01304c2e3b79e1/12f09/accuracy.png 148w,\n/ont-open-datasets/static/53bb1ce70c47b4b55e01304c2e3b79e1/e4a3f/accuracy.png 295w,\n/ont-open-datasets/static/53bb1ce70c47b4b55e01304c2e3b79e1/fcda8/accuracy.png 590w,\n/ont-open-datasets/static/53bb1ce70c47b4b55e01304c2e3b79e1/0a47e/accuracy.png 600w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The plot indicates a decrease of one-third in the modal error of reads.</p>","frontmatter":{"title":"Bonito basecalling with R9.4.1","date":"October 15, 2020","description":"Bonito basecalling with R9.4.1 and GM24385 (GIAB HG002)"}}},"pageContext":{"slug":"/bonito/","previous":{"fields":{"slug":"/gm24385_snp/"},"frontmatter":{"title":"Small variant calling with GM24385"}},"next":{"fields":{"slug":"/gm24385_2020.11/"},"frontmatter":{"title":"November 2020 GM24385 Dataset Release"}}}},"staticQueryHashes":["1246554614","1462070832","2841359383"]}